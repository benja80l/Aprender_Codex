<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>To-Do List</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:20px;background:#f5f5f5}
.todo-app{max-width:400px;margin:0 auto;background:#fff;padding:20px;border-radius:4px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
#new-task{width:70%;padding:8px}
#add-btn{padding:8px 12px;margin-left:4px}
#task-list{list-style:none;padding:0;margin-top:20px}
#task-list li{display:flex;align-items:center;padding:8px 0;border-bottom:1px solid #eee}
#task-list li.completed span{text-decoration:line-through;opacity:0.6}
#task-list li:last-child{border-bottom:none}
</style>
</head>
<body>
<div class="todo-app">
<input type="text" id="new-task" placeholder="New task">
<button id="add-btn">Add</button>
<ul id="task-list"></ul>
</div>
<script>
const taskInput=document.getElementById('new-task');
const addBtn=document.getElementById('add-btn');
const taskList=document.getElementById('task-list');
let tasks;
try {
  tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
  if (!Array.isArray(tasks)) tasks = [];
} catch (e) {
  tasks = [];
}
function save(){localStorage.setItem('tasks',JSON.stringify(tasks))}
function render() {
	// Only update changed elements instead of clearing all
	// For simplicity, if the number of tasks changes, re-render all
	if (taskList.children.length !== tasks.length) {
		taskList.innerHTML = '';
		tasks.forEach((t, i) => {
			const li = document.createElement('li');
			if (t.completed) li.classList.add('completed');
			const cb = document.createElement('input');
			cb.type = 'checkbox';
			cb.checked = t.completed;
			cb.addEventListener('change', () => {
				tasks[i].completed = cb.checked;
				save();
				render();
			});
			const span = document.createElement('span');
			span.textContent = t.text;
			li.appendChild(cb);
			li.appendChild(span);
			taskList.appendChild(li);
		});
	} else {
		// Update only changed elements
		tasks.forEach((t, i) => {
			const li = taskList.children[i];
			if (t.completed) {
				li.classList.add('completed');
			} else {
				li.classList.remove('completed');
			}
			const cb = li.querySelector('input[type="checkbox"]');
			if (cb.checked !== t.completed) {
				cb.checked = t.completed;
			}
			const span = li.querySelector('span');
			if (span.textContent !== t.text) {
				span.textContent = t.text;
			}
		});
	}
}
addBtn.addEventListener('click',()=>{const text=taskInput.value.trim();if(text){tasks.push({text,completed:false});taskInput.value='';save();render()}});
render();
</script>
</body>
</html>
